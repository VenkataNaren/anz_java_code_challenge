<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Order Process & Notification System</title>
	<style>
		/* Keep your existing CSS here */
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background-color: #f4f6f8;
			color: #333;
			padding: 30px;
		}

		h1,
		h2 {
			color: #2c3e50;
		}

		h1 {
			margin-bottom: 20px;
			text-align: center;
		}

		h2 {
			margin-top: 30px;
			margin-bottom: 15px;
		}

		.container {
			max-width: 900px;
			margin: 0 auto;
		}

		.form-group {
			display: flex;
			align-items: center;
			margin-bottom: 15px;
			gap: 10px;
			flex-wrap: wrap;
		}

		input[type="text"],
		select {
			flex: 1;
			padding: 10px 12px;
			border-radius: 6px;
			border: 1px solid #ccc;
			font-size: 16px;
			transition: border-color 0.3s;
		}

		input[type="text"]:focus,
		select:focus {
			border-color: #3498db;
			outline: none;
		}

		button {
			padding: 10px 20px;
			background-color: #3498db;
			color: white;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			font-size: 16px;
			transition: background-color 0.3s, transform 0.2s;
		}

		button:hover {
			background-color: #2980b9;
			transform: translateY(-2px);
		}

		table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 20px;
			background-color: white;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
			border-radius: 8px;
			overflow: hidden;
		}

		th,
		td {
			padding: 12px 15px;
			text-align: left;
			border-bottom: 1px solid #eee;
		}

		th {
			background-color: #3498db;
			color: white;
		}

		tr:hover {
			background-color: #f1f1f1;
		}

		select.status-select {
			padding: 6px 10px;
			border-radius: 6px;
			border: 1px solid #ccc;
			cursor: pointer;
		}

		.pagination {
			display: flex;
			justify-content: center;
			align-items: center;
			margin-top: 20px;
			gap: 10px;
		}

		.pagination button {
			padding: 8px 16px;
			font-size: 14px;
		}

		.pagination span {
			font-weight: bold;
		}

		.alert {
			padding: 12px;
			margin-top: 15px;
			border-radius: 6px;
			font-weight: bold;
		}

		.alert-success {
			background-color: #2ecc71;
			color: white;
		}

		.alert-error {
			background-color: #e74c3c;
			color: white;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>Order Process & Notification System</h1>

		<h2>Create Order</h2>
		<div class="form-group">
			<input type="text" id="orderName" placeholder="Order Description">
			<button onclick="createOrder()">Create</button>
		</div>

		<h2>Search Orders</h2>
		<div class="form-group">
			<select id="statusFilter">
				<option value="">All</option>
				<option value="CREATED">CREATED</option>
				<option value="COMPLETED">COMPLETED</option>
				<option value="CANCELLED">CANCELLED</option>
			</select>
			<button onclick="searchOrders()">Search</button>
		</div>

		<table id="ordersTable">
			<thead>
				<tr>
					<th>ID</th>
					<th>Description</th>
					<th>Status</th>
					<th>Update Status</th>
					<th>Created At</th>
				</tr>
			</thead>
			<tbody></tbody>
		</table>

		<div class="pagination">
			<button onclick="prevPage()">Previous</button>
			<span id="pageInfo">Page 1</span>
			<button onclick="nextPage()">Next</button>
		</div>
	</div>

	<script>
		const apiBase = '/orders';
		let currentPage = 0;
		const pageSize = 10;
		let totalPages = 1;

		// JWT token
		let jwtToken = '';

		// Automatically get token on page load
		async function getToken() {
			try {
				const username = 'testuser'; // Change if needed
				const res = await fetch(`/auth/token?username=${username}`, {method: 'POST'});
				jwtToken = await res.text();
				jwtToken = 'Bearer ' + jwtToken; // prepend Bearer
				console.log('JWT Token:', jwtToken);
			} catch (err) {
				console.error('Error fetching JWT:', err);
			}
		}

		// Helper to include JWT in fetch headers
		function authFetch(url, options = {}) {
			options.headers = {
				...options.headers,
				'Authorization': jwtToken,
			};
			return fetch(url, options);
		}

		function showAlert(message, type = 'success') {
			alert(message);
		}

		async function createOrder() {
			const description = document.getElementById('orderName').value;
			if (!description) return showAlert('Enter order description', 'error');

			try {
				const res = await authFetch(apiBase, {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({description})
				});
				const order = await res.json();
				showAlert(`Order created with ID: ${order.id}`);
				searchOrders(currentPage);
			} catch (err) {console.error(err);}
		}

		async function searchOrders(page = 0) {
			currentPage = page;
			const status = document.getElementById('statusFilter').value;
			let url = `${apiBase}?page=${currentPage}&size=${pageSize}`;
			if (status) url += `&status=${status}`;

			try {
				const res = await authFetch(url);
				const data = await res.json();
				const tableBody = document.querySelector('#ordersTable tbody');
				tableBody.innerHTML = '';

				const orders = Array.isArray(data.content) ? data.content : data;
				totalPages = data.totalPages || 1;

				orders.forEach(order => {
					const row = document.createElement('tr');
					row.innerHTML = `
                <td>${order.id}</td>
                <td>${order.description}</td>
                <td>${order.status}</td>
                <td>
                    <select class="status-select" onchange="updateStatus(${order.id}, this.value)">
                        <option value="CREATED" ${order.status === 'CREATED' ? 'selected' : ''}>CREATED</option>
                        <option value="COMPLETED" ${order.status === 'COMPLETED' ? 'selected' : ''}>COMPLETED</option>
                        <option value="CANCELLED" ${order.status === 'CANCELLED' ? 'selected' : ''}>CANCELLED</option>
                    </select>
                </td>
                <td>${order.createdAt}</td>
            `;
					tableBody.appendChild(row);
				});

				document.getElementById('pageInfo').textContent = `Page ${currentPage + 1} of ${totalPages}`;
			} catch (err) {console.error(err);}
		}

		async function updateStatus(id, status) {
			try {
				await authFetch(`${apiBase}/${id}/status?status=${status}`, {method: 'PUT'});
				searchOrders(currentPage);
			} catch (err) {console.error(err);}
		}

		function nextPage() {
			if (currentPage + 1 < totalPages) searchOrders(currentPage + 1);
		}

		function prevPage() {
			if (currentPage > 0) searchOrders(currentPage - 1);
		}

		// Initialize
		getToken().then(() => searchOrders());
	</script>
</body>

</html>